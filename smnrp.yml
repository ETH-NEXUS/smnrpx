domains:
  echo.7f000001.nip.io:
    disable_https: false
    cert: ${SMNRP_CERT}
    # sans:
    #   - www.echo.7f000001.nip.io
    upstreams:
      api:
        - echo:80
    locations:
      - proxy:
          uri: /
          proto: http
          upstream: api
          path: /
    csp: "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    proxy_buffer_size: 32k
    client_max_body_size: 1m
    client_body_buffer_size: 1k
    allow_tls1.2: false
    disable_ocsp_stapling: false

  search.7f000001.nip.io:
    cert: ${SMNRP_CERT}
    sans:
      - www.search.7f000001.nip.io
    ports:
      http: 80
      https: 8443
      exposed_https: 8443
    upstreams:
      google:
        - google.com:443
    locations:
      - proxy:
          disable_cache: true
          uri: /search
          proto: https
          upstream: google
          path: /
          auth:
            - user: admin
              password: admin
            - user: dave
              password: secret
          whitelist:
            - 127.0.0.1
          custom:
            - proxy_set_header Host $http_host
      - alias:
          uri: /media
          path: /usr/local/media
          internal: true
          try_files: true
          auth:
            - user: user
              password: user
      - redirect:
          uri: /redir
          url: http://google.com
